// üåê IA MARKETING & PUBLICATION - JavaScript avanc√© pour Cynthia
// Syst√®me complet de gestion marketing immobilier avec IA

class MarketingIAManager {
    constructor() {
        this.properties = [];
        this.campaigns = [];
        this.socialPosts = [];
        this.websiteContent = {};
        this.aiMarketingConversation = [];
        this.socialStats = {
            facebook: { followers: 1234, reach: 5678 },
            instagram: { followers: 987, stories: 456 },
            youtube: { subscribers: 234, views: 12345 },
            linkedin: { connections: 456, profileViews: 123 }
        };
        
        this.init();
    }

    // M√©thode pour appeler OpenAI WebApp sp√©cifiquement pour le marketing
    async callOpenAIWebAppMarketing(prompt, systemMessage = null) {
        try {
            // Utiliser les variables d'environnement Vercel
            const apiKey = window.ENV?.CYNTHIA_WEBAPP_OPENAI_KEY || process.env.CYNTHIA_WEBAPP_OPENAI_KEY;
            
            if (!apiKey || apiKey.includes('HERE')) {
                throw new Error('Cl√© OpenAI WebApp non configur√©e');
            }

            const messages = [];
            
            if (systemMessage) {
                messages.push({
                    role: 'system',
                    content: systemMessage
                });
            }
            
            messages.push({
                role: 'user',
                content: prompt
            });

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: messages,
                    temperature: 0.4,
                    max_tokens: 800
                })
            });

            if (!response.ok) {
                throw new Error(`API OpenAI WebApp Marketing error: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
            
        } catch (error) {
            console.error('‚ùå Erreur OpenAI WebApp Marketing:', error);
            throw error;
        }
    }

    async init() {
        console.log('üåê Initialisation IA Marketing & Publication...');
        
        // Charger les donn√©es existantes
        await this.loadMarketingData();
        
        // Initialiser l'interface
        this.initializeStats();
        this.loadAIMarketingConversation();
        this.renderPublishedProperties();
        this.renderActiveCampaigns();
        this.setupEventListeners();
        
        // D√©marrer l'assistant IA Marketing
        this.initializeMarketingAI();
        
        console.log('‚úÖ IA Marketing & Publication initialis√©');
    }

    async loadMarketingData() {
        try {
            // Charger donn√©es depuis localStorage
            const savedProperties = localStorage.getItem('cynthia_published_properties');
            if (savedProperties) {
                this.properties = JSON.parse(savedProperties);
            }
            
            const savedCampaigns = localStorage.getItem('cynthia_marketing_campaigns');
            if (savedCampaigns) {
                this.campaigns = JSON.parse(savedCampaigns);
            }
            
            const savedWebsiteContent = localStorage.getItem('cynthia_website_content');
            if (savedWebsiteContent) {
                this.websiteContent = JSON.parse(savedWebsiteContent);
            } else {
                // Contenu par d√©faut
                this.websiteContent = {
                    home: {
                        title: 'Cynthia Bernier - Courti√®re Immobili√®re',
                        description: 'Votre experte immobili√®re √† Lebel-sur-Qu√©villon. Service personnalis√© pour vente, achat et √©valuation de propri√©t√©s r√©sidentielles.'
                    },
                    about: {
                        bio: 'Courti√®re immobili√®re r√©sidentielle exp√©riment√©e, je dessers la r√©gion de Lebel-sur-Qu√©villon avec passion et professionnalisme depuis plus de 10 ans.'
                    },
                    services: {
                        list: '‚Ä¢ Vente r√©sidentielle\n‚Ä¢ Achat accompagn√©\n‚Ä¢ √âvaluation gratuite\n‚Ä¢ Consultation march√© immobilier'
                    },
                    contact: {
                        info: 'üìû 418-XXX-XXXX\nüìß cynthia@domain.com\nüìç Lebel-sur-Qu√©villon, QC'
                    }
                };
            }
            
        } catch (error) {
            console.warn('‚ö†Ô∏è Erreur chargement donn√©es marketing:', error);
        }
    }

    initializeStats() {
        // Mettre √† jour les stats affich√©es
        document.getElementById('websiteViews').textContent = Math.floor(Math.random() * 2000) + 1000;
        document.getElementById('publishedProperties').textContent = this.properties.length;
        document.getElementById('socialEngagement').textContent = Math.floor(Math.random() * 500) + 200;
        document.getElementById('marketingCampaigns').textContent = this.campaigns.length;
        
        // Stats r√©seaux sociaux
        document.getElementById('facebookFollowers').textContent = this.socialStats.facebook.followers;
        document.getElementById('facebookReach').textContent = this.socialStats.facebook.reach;
        document.getElementById('instagramFollowers').textContent = this.socialStats.instagram.followers;
        document.getElementById('instagramStories').textContent = this.socialStats.instagram.stories;
        document.getElementById('youtubeSubscribers').textContent = this.socialStats.youtube.subscribers;
        document.getElementById('youtubeViews').textContent = this.socialStats.youtube.views;
        document.getElementById('linkedinConnections').textContent = this.socialStats.linkedin.connections;
        document.getElementById('linkedinProfileViews').textContent = this.socialStats.linkedin.profileViews;
    }

    loadAIMarketingConversation() {
        const saved = localStorage.getItem('cynthia_ai_marketing_conversation');
        if (saved) {
            this.aiMarketingConversation = JSON.parse(saved);
        } else {
            this.aiMarketingConversation = [
                {
                    type: 'ai',
                    content: 'Bonjour Cynthia ! Je suis votre assistant IA Marketing sp√©cialis√© en immobilier. Je peux vous aider avec la gestion de votre site web, la publication de fiches immobili√®res, et vos campagnes sur les r√©seaux sociaux. Par quoi voulez-vous commencer ?',
                    timestamp: new Date()
                }
            ];
        }
        
        this.renderAIMarketingConversation();
    }

    renderAIMarketingConversation() {
        const chatMessages = document.getElementById('aiMarketingChatMessages');
        
        chatMessages.innerHTML = this.aiMarketingConversation.map(message => `
            <div class="message ${message.type}-message">
                <div class="message-content">
                    <p><strong>${message.type === 'ai' ? 'Marketing IA' : 'Vous'}:</strong> ${message.content}</p>
                    <small class="message-time">${this.formatTime(message.timestamp)}</small>
                </div>
            </div>
        `).join('');
        
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    setupEventListeners() {
        // Chat IA Marketing
        document.getElementById('aiMarketingChatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.sendMarketingAiMessage();
            }
        });
        
        // Chargement du contenu web dans l'√©diteur
        this.loadWebsiteContentIntoEditor();
    }

    loadWebsiteContentIntoEditor() {
        // Charger le contenu existant dans les champs d'√©dition
        if (this.websiteContent.home) {
            document.getElementById('homeTitle').value = this.websiteContent.home.title;
            document.getElementById('homeDescription').value = this.websiteContent.home.description;
        }
        if (this.websiteContent.about) {
            document.getElementById('aboutBio').value = this.websiteContent.about.bio;
        }
        if (this.websiteContent.services) {
            document.getElementById('servicesList').value = this.websiteContent.services.list;
        }
        if (this.websiteContent.contact) {
            document.getElementById('contactInfo').value = this.websiteContent.contact.info;
        }
    }

    initializeMarketingAI() {
        // Ajouter exemples de propri√©t√©s si vide
        if (this.properties.length === 0) {
            this.properties = [
                {
                    id: Date.now(),
                    address: '123 Rue des √ârables, Lebel-sur-Qu√©villon',
                    price: 245000,
                    bedrooms: 3,
                    bathrooms: 2,
                    size: 1450,
                    type: 'Bungalow',
                    description: 'Magnifique bungalow situ√© dans un secteur paisible de Lebel-sur-Qu√©villon. Cette propri√©t√© offre un excellent potentiel avec ses 3 chambres, 2 salles de bain et un sous-sol am√©nageable.',
                    photos: [],
                    publishedDate: new Date(),
                    status: 'active'
                }
            ];
            this.saveProperties();
        }
        
        // Ajouter exemples de campagnes si vide
        if (this.campaigns.length === 0) {
            this.campaigns = [
                {
                    id: Date.now(),
                    name: 'Campagne Printemps 2024',
                    type: 'R√©seaux sociaux',
                    status: 'active',
                    budget: 500,
                    platforms: ['Facebook', 'Instagram'],
                    startDate: new Date(),
                    endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                }
            ];
            this.saveCampaigns();
        }
    }

    // ü§ñ Fonctions IA Marketing Chat
    async sendMarketingAiMessage() {
        const input = document.getElementById('aiMarketingChatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Ajouter message utilisateur
        this.aiMarketingConversation.push({
            type: 'user',
            content: message,
            timestamp: new Date()
        });
        
        // Afficher "IA en cours de r√©flexion..."
        this.aiMarketingConversation.push({
            type: 'ai',
            content: 'ü§î Analyse en cours...',
            timestamp: new Date()
        });
        
        this.renderAIMarketingConversation();
        input.value = '';
        
        try {
            // Appel r√©el √† l'API OpenAI WebApp pour le marketing
            const aiResponse = await this.callOpenAIWebAppMarketing(
                message,
                "Tu es l'assistante IA marketing de Cynthia Bernier, courti√®re immobili√®re √† Lebel-sur-Qu√©villon. Tu aides avec le marketing, la gestion du site web, les r√©seaux sociaux, et la publication de propri√©t√©s. R√©ponds avec expertise en marketing immobilier."
            );
            
            // Remplacer le message temporaire
            this.aiMarketingConversation[this.aiMarketingConversation.length - 1] = {
                type: 'ai',
                content: aiResponse,
                timestamp: new Date()
            };
            
        } catch (error) {
            console.error('Erreur API OpenAI Marketing:', error);
            
            // Message d'erreur si API ne fonctionne pas
            this.aiMarketingConversation[this.aiMarketingConversation.length - 1] = {
                type: 'ai',
                content: '‚ö†Ô∏è Service marketing temporairement indisponible. Veuillez r√©essayer dans quelques instants.',
                timestamp: new Date()
            };
        }
        
        this.renderAIMarketingConversation();
        this.saveAIMarketingConversation();
    }

    generateMarketingAIResponse(userMessage) {
        const message = userMessage.toLowerCase();
        
        if (message.includes('site') || message.includes('web')) {
            return 'Je peux vous aider √† optimiser votre site web ! Voulez-vous mettre √† jour le contenu, am√©liorer le SEO, ou analyser les performances ? Votre site cynthiabernier.com peut b√©n√©ficier de contenu localis√© pour Lebel-sur-Qu√©villon.';
        }
        
        if (message.includes('fiche') || message.includes('propri√©t√©') || message.includes('maison')) {
            return 'Parfait pour les fiches immobili√®res ! Je peux g√©n√©rer des descriptions optimis√©es, sugg√©rer des photos professionnelles, et cr√©er du contenu pour vos r√©seaux sociaux. Quelle propri√©t√© voulez-vous mettre en avant ?';
        }
        
        if (message.includes('facebook') || message.includes('instagram') || message.includes('social')) {
            return 'Excellente strat√©gie r√©seaux sociaux ! Je peux cr√©er du contenu engageant, planifier vos publications, et optimiser vos campagnes. Voulez-vous que je g√©n√®re un post sur une nouvelle propri√©t√© ou des conseils immobiliers ?';
        }
        
        if (message.includes('campagne') || message.includes('marketing') || message.includes('publicit√©')) {
            return 'Les campagnes marketing sont essentielles ! Je peux vous aider √† cr√©er des campagnes cibl√©es pour Lebel-sur-Qu√©villon, analyser le ROI, et optimiser vos budgets publicitaires. Quel est votre objectif principal ?';
        }
        
        if (message.includes('seo') || message.includes('r√©f√©rencement')) {
            return 'Le SEO local est crucial pour l\'immobilier ! Je vais optimiser votre contenu avec des mots-cl√©s comme "courti√®re Lebel-sur-Qu√©villon", "maison √† vendre Nord-du-Qu√©bec". Voulez-vous que j\'analyse vos pages actuelles ?';
        }
        
        if (message.includes('client') || message.includes('lead')) {
            return 'G√©n√©rer des prospects qualifi√©s est ma sp√©cialit√© ! Je peux cr√©er du contenu attractif, optimiser vos formulaires de contact, et d√©velopper des strat√©gies de nurturing. Combien de nouveaux clients visez-vous ce mois ?';
        }
        
        return 'Je suis votre expert IA en marketing immobilier ! Je peux vous accompagner sur : üåê Gestion site web, üè† Publication fiches, üì± R√©seaux sociaux, üìà Campagnes marketing, üîç SEO local, et üë• G√©n√©ration de leads. Quelle est votre priorit√© ?';
    }

    saveAIMarketingConversation() {
        localStorage.setItem('cynthia_ai_marketing_conversation', JSON.stringify(this.aiMarketingConversation));
    }

    // üåê Fonctions Gestion Site Web
    saveWebsiteContent() {
        this.websiteContent = {
            home: {
                title: document.getElementById('homeTitle').value,
                description: document.getElementById('homeDescription').value
            },
            about: {
                bio: document.getElementById('aboutBio').value
            },
            services: {
                list: document.getElementById('servicesList').value
            },
            contact: {
                info: document.getElementById('contactInfo').value
            }
        };
        
        localStorage.setItem('cynthia_website_content', JSON.stringify(this.websiteContent));
    }

    // üè† Fonctions Publication Propri√©t√©s
    generatePropertyDescription() {
        const address = document.getElementById('propertyAddress').value;
        const price = document.getElementById('propertyPrice').value;
        const bedrooms = document.getElementById('propertyBedrooms').value;
        const bathrooms = document.getElementById('propertyBathrooms').value;
        const size = document.getElementById('propertySize').value;
        const type = document.getElementById('propertyType').value;
        
        if (!address || !price) {
            alert('‚ö†Ô∏è Veuillez saisir au moins l\'adresse et le prix pour g√©n√©rer une description');
            return;
        }
        
        const descriptions = [
            `Magnifique ${type.toLowerCase()} situ√©${type.includes('Maison') ? 'e' : ''} au ${address}. Cette propri√©t√© exceptionnelle de ${size} pi¬≤ offre ${bedrooms} chambres spacieuses et ${bathrooms} salle${bathrooms > 1 ? 's' : ''} de bain moderne${bathrooms > 1 ? 's' : ''}. 

üè† Caract√©ristiques principales :
‚Ä¢ Localisation privil√©gi√©e √† Lebel-sur-Qu√©villon
‚Ä¢ Finitions de qualit√© sup√©rieure
‚Ä¢ Environnement paisible et familial
‚Ä¢ Proximit√© des services essentiels

Cette propri√©t√© repr√©sente une opportunit√© unique dans le march√© immobilier du Nord-du-Qu√©bec. Parfaite pour une famille recherchant confort et tranquillit√©.

Prix demand√© : ${parseInt(price).toLocaleString('fr-CA')} $

Contactez Cynthia Bernier d√®s maintenant pour planifier votre visite !
üìû 418-XXX-XXXX`,

            `D√©couvrez ce superbe ${type.toLowerCase()} de ${size} pi¬≤ situ√© dans un secteur recherch√© de Lebel-sur-Qu√©villon. Avec ses ${bedrooms} chambres et ${bathrooms} salle${bathrooms > 1 ? 's' : ''} de bain, cette propri√©t√© saura r√©pondre √† tous vos besoins.

‚ú® Points forts :
‚Ä¢ Architecture moderne et fonctionnelle
‚Ä¢ Espaces de vie lumineux et bien agenc√©s
‚Ä¢ Terrain paysager et entretenu
‚Ä¢ Secteur tranquille et s√©curitaire

Le march√© immobilier de Lebel-sur-Qu√©villon offre des opportunit√©s exceptionnelles, et cette propri√©t√© en est un parfait exemple. Id√©ale pour investisseurs ou propri√©taires occupants.

Offerte √† ${parseInt(price).toLocaleString('fr-CA')} $

Votre courti√®re experte Cynthia Bernier vous accompagne dans ce projet immobilier !`
        ];
        
        const selectedDescription = descriptions[Math.floor(Math.random() * descriptions.length)];
        document.getElementById('propertyDescription').value = selectedDescription;
        
        this.addAIMarketingMessage('‚ú®', 'Description g√©n√©r√©e', 'Description IA cr√©√©e avec optimisation SEO locale');
    }

    optimizePropertyForSEO() {
        const description = document.getElementById('propertyDescription').value;
        if (!description) {
            alert('‚ö†Ô∏è Veuillez d\'abord saisir ou g√©n√©rer une description');
            return;
        }
        
        let optimizedDescription = description;
        
        // Ajouter mots-cl√©s SEO locaux
        const seoKeywords = [
            'Lebel-sur-Qu√©villon',
            'Nord-du-Qu√©bec',
            'courti√®re immobili√®re',
            'propri√©t√© r√©sidentielle',
            'maison √† vendre'
        ];
        
        // V√©rifier et ajouter mots-cl√©s manquants
        seoKeywords.forEach(keyword => {
            if (!optimizedDescription.toLowerCase().includes(keyword.toLowerCase())) {
                optimizedDescription += `\n\nüîç Mots-cl√©s : ${keyword}`;
            }
        });
        
        // Ajouter call-to-action optimis√©
        if (!optimizedDescription.includes('Contactez')) {
            optimizedDescription += '\n\nüìû Contactez Cynthia Bernier, votre experte immobili√®re locale, pour une visite personnalis√©e !';
        }
        
        document.getElementById('propertyDescription').value = optimizedDescription;
        
        this.addAIMarketingMessage('üîç', 'SEO optimis√©', 'Description optimis√©e pour le r√©f√©rencement local');
    }

    analyzePropertyMarket() {
        const price = parseInt(document.getElementById('propertyPrice').value);
        const type = document.getElementById('propertyType').value;
        
        if (!price) {
            alert('‚ö†Ô∏è Veuillez saisir le prix pour l\'analyse de march√©');
            return;
        }
        
        // Simuler analyse de march√©
        const marketAnalysis = this.generateMarketAnalysis(price, type);
        
        alert(`üìä ANALYSE DE MARCH√â - LEBEL-SUR-QU√âVILLON\n\n${marketAnalysis.join('\n\n')}`);
        
        this.addAIMarketingMessage('üìä', 'Analyse march√©', 'Rapport de march√© g√©n√©r√© avec comparaisons locales');
    }

    generateMarketAnalysis(price, type) {
        const avgPrice = 235000;
        const priceComparison = price > avgPrice ? 'sup√©rieur' : 'inf√©rieur';
        const priceDiff = Math.abs(((price - avgPrice) / avgPrice) * 100).toFixed(1);
        
        return [
            `üí∞ √âVALUATION PRIX\nVotre prix (${price.toLocaleString('fr-CA')} $) est ${priceDiff}% ${priceComparison} √† la moyenne locale (${avgPrice.toLocaleString('fr-CA')} $)`,
            
            `üè† MARCH√â ${type.toUpperCase()}\n‚Ä¢ Demande : ${Math.random() > 0.5 ? '√âlev√©e' : 'Mod√©r√©e'}\n‚Ä¢ Temps vente moyen : ${Math.floor(Math.random() * 60) + 30} jours\n‚Ä¢ Concurrence : ${Math.floor(Math.random() * 5) + 2} propri√©t√©s similaires`,
            
            `üìà TENDANCES LEBEL-SUR-QU√âVILLON\n‚Ä¢ √âvolution prix : +${(Math.random() * 10 + 2).toFixed(1)}% cette ann√©e\n‚Ä¢ Activit√© march√© : Dynamique\n‚Ä¢ Meilleure p√©riode : Printemps-√ât√©`,
            
            `üí° RECOMMANDATIONS\n‚Ä¢ Prix comp√©titif pour le secteur\n‚Ä¢ Mise en valeur points forts recommand√©e\n‚Ä¢ Marketing cibl√© Nord-du-Qu√©bec\n‚Ä¢ Photos professionnelles essentielles`
        ];
    }

    publishProperty() {
        const propertyData = {
            id: Date.now(),
            address: document.getElementById('propertyAddress').value,
            price: parseInt(document.getElementById('propertyPrice').value),
            bedrooms: document.getElementById('propertyBedrooms').value,
            bathrooms: document.getElementById('propertyBathrooms').value,
            size: parseInt(document.getElementById('propertySize').value),
            type: document.getElementById('propertyType').value,
            description: document.getElementById('propertyDescription').value,
            photos: document.getElementById('propertyPhotos').value.split(',').map(url => url.trim()).filter(url => url),
            publishedDate: new Date(),
            status: 'active'
        };
        
        if (!propertyData.address || !propertyData.price) {
            alert('‚ö†Ô∏è Veuillez remplir au moins l\'adresse et le prix');
            return;
        }
        
        this.properties.push(propertyData);
        this.saveProperties();
        
        // Vider le formulaire
        document.getElementById('propertyAddress').value = '';
        document.getElementById('propertyPrice').value = '';
        document.getElementById('propertySize').value = '';
        document.getElementById('propertyDescription').value = '';
        document.getElementById('propertyPhotos').value = '';
        
        // Actualiser l'affichage
        this.renderPublishedProperties();
        this.initializeStats();
        
        // Proposer publication sur r√©seaux sociaux
        if (confirm('üöÄ Propri√©t√© publi√©e avec succ√®s !\n\nVoulez-vous √©galement la publier sur vos r√©seaux sociaux ?')) {
            this.autoPostToSocialMedia(propertyData);
        }
        
        this.addAIMarketingMessage('üè†', 'Propri√©t√© publi√©e', `${propertyData.address} ajout√©e avec succ√®s`);
    }

    renderPublishedProperties() {
        const propertiesList = document.getElementById('publishedPropertiesList');
        
        if (this.properties.length === 0) {
            propertiesList.innerHTML = '<p class="no-properties">Aucune propri√©t√© publi√©e</p>';
            return;
        }
        
        propertiesList.innerHTML = this.properties.map(property => `
            <div class="property-card">
                <div class="property-header">
                    <h4>${property.address}</h4>
                    <span class="property-price">${property.price.toLocaleString('fr-CA')} $</span>
                </div>
                <div class="property-details">
                    <span>üõèÔ∏è ${property.bedrooms} ‚Ä¢ üõÅ ${property.bathrooms} ‚Ä¢ üìê ${property.size} pi¬≤</span>
                </div>
                <div class="property-actions">
                    <button onclick="editProperty(${property.id})" class="btn-edit">‚úèÔ∏è Modifier</button>
                    <button onclick="shareProperty(${property.id})" class="btn-share">üì± Partager</button>
                    <button onclick="deleteProperty(${property.id})" class="btn-delete">üóëÔ∏è Supprimer</button>
                </div>
            </div>
        `).join('');
    }

    saveProperties() {
        localStorage.setItem('cynthia_published_properties', JSON.stringify(this.properties));
    }

    // üì± Fonctions R√©seaux Sociaux
    autoPostToSocialMedia(propertyData) {
        const socialContent = this.generateSocialMediaContent(propertyData);
        
        // Simuler publication sur les plateformes connect√©es
        const platforms = ['Facebook', 'Instagram', 'LinkedIn'];
        platforms.forEach(platform => {
            this.simulatePostToPlatform(platform, socialContent);
        });
        
        alert(`üì± Publication automatique r√©ussie !\n\n‚úÖ Facebook : Post cr√©√©\n‚úÖ Instagram : Photo publi√©e\n‚úÖ LinkedIn : Article professionnel\n\nüìä Port√©e estim√©e : ${Math.floor(Math.random() * 1000) + 500} personnes`);
    }

    generateSocialMediaContent(propertyData) {
        const templates = [
            `üè† NOUVELLE PROPRI√âT√â DISPONIBLE ! üè†

üìç ${propertyData.address}
üí∞ ${propertyData.price.toLocaleString('fr-CA')} $
üõèÔ∏è ${propertyData.bedrooms} chambres | üõÅ ${propertyData.bathrooms} sdb
üìê ${propertyData.size} pi¬≤

${propertyData.type} situ√© dans un secteur recherch√© de Lebel-sur-Qu√©villon. Une opportunit√© √† ne pas manquer !

üëÄ Visite? Contactez-moi!
üìû 418-XXX-XXXX

#LebelsurQuevillon #Immobilier #MaisonAVendre #NordduQuebec #CynthiaBernier`,

            `‚ú® COUP DE C≈íUR IMMOBILIER ‚ú®

Je suis fi√®re de vous pr√©senter cette magnifique propri√©t√© √† ${propertyData.address} !

üåü Caract√©ristiques :
‚Ä¢ ${propertyData.bedrooms} chambres spacieuses
‚Ä¢ ${propertyData.bathrooms} salle${propertyData.bathrooms > 1 ? 's' : ''} de bain
‚Ä¢ ${propertyData.size} pi¬≤ bien agenc√©s
‚Ä¢ Secteur paisible √† Lebel-sur-Qu√©villon

Prix : ${propertyData.price.toLocaleString('fr-CA')} $

Planifions votre visite d√®s aujourd'hui !

#Immobilier #Courtiere #LebelsurQuevillon #Maison`
        ];
        
        return templates[Math.floor(Math.random() * templates.length)];
    }

    simulatePostToPlatform(platform, content) {
        const post = {
            id: Date.now() + Math.random(),
            platform: platform,
            content: content,
            publishedAt: new Date(),
            engagement: Math.floor(Math.random() * 50) + 10
        };
        
        this.socialPosts.push(post);
    }

    generateSocialContent() {
        const postType = document.getElementById('postType').value;
        const contentTextarea = document.getElementById('postContent');
        
        let generatedContent = '';
        
        switch (postType) {
            case 'Nouvelle propri√©t√©':
                generatedContent = `üè† NOUVELLE OPPORTUNIT√â IMMOBILI√àRE !

D√©couvrez cette magnifique propri√©t√© √† Lebel-sur-Qu√©villon qui vient tout juste d'√™tre mise sur le march√© !

‚ú® Points forts :
‚Ä¢ Localisation exceptionnelle
‚Ä¢ Finitions de qualit√©
‚Ä¢ Environnement paisible
‚Ä¢ Potentiel d'investissement

Votre future maison vous attend peut-√™tre ici ! 

üìû Contactez-moi pour une visite priv√©e
Cynthia Bernier - Votre experte immobili√®re locale

#LebelsurQuevillon #NordduQuebec #Immobilier #MaisonAVendre #Courtiere`;
                break;
                
            case 'T√©moignage client':
                generatedContent = `üí¨ T√âMOIGNAGE CLIENT

"Merci Cynthia pour ton professionnalisme et ta disponibilit√© ! Gr√¢ce √† ton expertise du march√© de Lebel-sur-Qu√©villon, nous avons trouv√© LA maison parfaite pour notre famille. Ton accompagnement personnalis√© a fait toute la diff√©rence !" 

- Famille Tremblay ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

C'est √ßa, la satisfaction client ! Chaque projet immobilier est unique et m√©rite une attention particuli√®re.

üè† Vous cherchez √† vendre ou acheter ? Parlons-en !

#Testimoignage #ServiceClient #Immobilier #LebelsurQuevillon`;
                break;
                
            case 'Conseil immobilier':
                generatedContent = `üí° CONSEIL IMMOBILIER DU JOUR

üè† ACHETEURS : Les 3 questions essentielles avant de visiter :

1Ô∏è‚É£ "Quels sont les travaux √† pr√©voir ?"
2Ô∏è‚É£ "Comment est le voisinage ?"  
3Ô∏è‚É£ "Y a-t-il eu des r√©novations r√©centes ?"

Ces questions vous feront gagner du temps ET de l'argent ! 

En tant que courti√®re locale √† Lebel-sur-Qu√©villon, je connais chaque secteur et peux vous guider vers les meilleures d√©cisions.

üìû Une question ? Je suis l√† !

#ConseilImmobilier #Acheteur #LebelsurQuevillon #ExpertiseLocale`;
                break;
                
            case 'March√© local':
                generatedContent = `üìà MARCH√â IMMOBILIER LEBEL-SUR-QU√âVILLON

Excellentes nouvelles pour notre r√©gion ! 

‚úÖ Augmentation de 8% des ventes ce trimestre
‚úÖ Temps de vente moyen : 45 jours  
‚úÖ Int√©r√™t croissant pour le Nord-du-Qu√©bec
‚úÖ Prix stables et attractifs

C'est le moment id√©al pour :
üè† Vendre votre propri√©t√©
üîç Investir dans l'immobilier local
üìä √âvaluer votre patrimoine

Besoin d'une analyse personnalis√©e de votre situation ? Contactez-moi !

#MarcheImmobilier #LebelsurQuevillon #NordduQuebec #Investissement`;
                break;
                
            case 'Personnel/Behind the scenes':
                generatedContent = `üëã DANS LES COULISSES...

Une journ√©e dans la vie d'une courti√®re immobili√®re √† Lebel-sur-Qu√©villon :

üåÖ 7h00 - Caf√© et r√©vision des dossiers clients
üìû 9h00 - Appels de suivi et nouvelles demandes  
üè† 10h30 - Visite de propri√©t√© avec des acheteurs
üìù 14h00 - Pr√©paration d'offres d'achat
üöó 16h00 - Photos d'une nouvelle inscription
üì± 18h00 - R√©ponse aux messages et planification

Chaque journ√©e est diff√©rente, mais la passion pour l'immobilier reste constante ! 

‚ù§Ô∏è J'adore ce que je fais et √ßa para√Æt !

#BehindTheScenes #Courtiere #Passion #LebelsurQuevillon`;
                break;
        }
        
        contentTextarea.value = generatedContent;
        
        this.addAIMarketingMessage('‚ú®', 'Contenu g√©n√©r√©', `Post ${postType} cr√©√© avec hashtags optimis√©s`);
    }

    addHashtags() {
        const contentTextarea = document.getElementById('postContent');
        const currentContent = contentTextarea.value;
        
        const hashtags = [
            '#LebelsurQuevillon',
            '#NordduQuebec',
            '#Immobilier',
            '#CourtiereImmobiliere',
            '#CynthiaBernier',
            '#MaisonAVendre',
            '#AchatMaison',
            '#ImmobilierResidentiel',
            '#ConseilImmobilier',
            '#ExpertiseLocale'
        ];
        
        const randomHashtags = hashtags.sort(() => 0.5 - Math.random()).slice(0, 5);
        
        if (!currentContent.includes('#')) {
            contentTextarea.value += '\n\n' + randomHashtags.join(' ');
        } else {
            // Remplacer ou am√©liorer hashtags existants
            const hashtagsToAdd = randomHashtags.filter(tag => !currentContent.includes(tag));
            if (hashtagsToAdd.length > 0) {
                contentTextarea.value += ' ' + hashtagsToAdd.join(' ');
            }
        }
        
        this.addAIMarketingMessage('#Ô∏è‚É£', 'Hashtags ajout√©s', 'Tags optimis√©s pour port√©e locale');
    }

    // üìà Fonctions Campagnes Marketing
    createMarketingCampaign() {
        const campaignName = prompt('Nom de la nouvelle campagne :');
        if (!campaignName) return;
        
        const campaignType = prompt('Type de campagne :\n1. R√©seaux sociaux\n2. Google Ads\n3. Email marketing\n4. Affichage local\n\nTapez le num√©ro ou le nom :');
        if (!campaignType) return;
        
        const budget = prompt('Budget mensuel ($) :');
        if (!budget || isNaN(budget)) return;
        
        const campaign = {
            id: Date.now(),
            name: campaignName,
            type: campaignType.includes('1') ? 'R√©seaux sociaux' : campaignType,
            status: 'active',
            budget: parseInt(budget),
            platforms: ['Facebook', 'Instagram'],
            startDate: new Date(),
            endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
            performance: {
                impressions: 0,
                clicks: 0,
                leads: 0,
                cost: 0
            }
        };
        
        this.campaigns.push(campaign);
        this.saveCampaigns();
        this.renderActiveCampaigns();
        this.initializeStats();
        
        alert(`üöÄ Campagne "${campaignName}" cr√©√©e avec succ√®s !\n\nüìä Budget : ${budget} $\nüìÖ Dur√©e : 30 jours\nüéØ Optimisation automatique activ√©e`);
        
        this.addAIMarketingMessage('üöÄ', 'Campagne cr√©√©e', `${campaignName} lanc√©e avec budget ${budget}$`);
    }

    renderActiveCampaigns() {
        const campaignsList = document.getElementById('activeCampaignsList');
        
        if (this.campaigns.length === 0) {
            campaignsList.innerHTML = '<p class="no-campaigns">Aucune campagne active</p>';
            return;
        }
        
        campaignsList.innerHTML = this.campaigns.map(campaign => `
            <div class="campaign-card">
                <div class="campaign-header">
                    <h4>${campaign.name}</h4>
                    <span class="campaign-status ${campaign.status}">${campaign.status}</span>
                </div>
                <div class="campaign-details">
                    <p><strong>Type :</strong> ${campaign.type}</p>
                    <p><strong>Budget :</strong> ${campaign.budget} $ / mois</p>
                    <p><strong>Performance :</strong> ${Math.floor(Math.random() * 100)} leads g√©n√©r√©s</p>
                </div>
                <div class="campaign-actions">
                    <button onclick="editCampaign(${campaign.id})" class="btn-edit-campaign">‚úèÔ∏è Modifier</button>
                    <button onclick="pauseCampaign(${campaign.id})" class="btn-pause-campaign">‚è∏Ô∏è Pauser</button>
                    <button onclick="deleteCampaign(${campaign.id})" class="btn-delete-campaign">üóëÔ∏è Supprimer</button>
                </div>
            </div>
        `).join('');
    }

    saveCampaigns() {
        localStorage.setItem('cynthia_marketing_campaigns', JSON.stringify(this.campaigns));
    }

    // Utilitaires
    addAIMarketingMessage(icon, title, message) {
        if (window.cynthiaDashboard) {
            window.cynthiaDashboard.addNotification(icon, title, message, 'success');
        }
    }

    formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMinutes = Math.floor((now - date) / (1000 * 60));
        
        if (diffMinutes < 1) return 'Maintenant';
        if (diffMinutes < 60) return `${diffMinutes} min`;
        if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)} h`;
        return date.toLocaleDateString('fr-CA');
    }
}

// üåê Fonctions globales pour l'interface

function refreshMarketingData() {
    if (window.marketingIAManager) {
        window.marketingIAManager.initializeStats();
        window.marketingIAManager.renderPublishedProperties();
        window.marketingIAManager.renderActiveCampaigns();
        
        console.log('üîÑ Donn√©es marketing actualis√©es');
        alert('‚úÖ Donn√©es marketing actualis√©es !');
    }
}

function goBackToDashboard() {
    window.location.href = 'index.html';
}

function sendMarketingAiMessage() {
    if (window.marketingIAManager) {
        window.marketingIAManager.sendMarketingAiMessage();
    }
}

// Gestion Site Web
function showWebsiteTab(tabName) {
    document.querySelectorAll('.editor-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.editor-tab-content').forEach(content => content.classList.remove('active'));
    
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(`${tabName}-tab`).classList.add('active');
}

function previewWebsite() {
    alert('üåê PR√âVISUALISATION SITE WEB\n\nVotre site cynthiabernier.com sera affich√© dans un nouvel onglet avec les derni√®res modifications.\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function editWebsite() {
    if (window.marketingIAManager) {
        window.marketingIAManager.saveWebsiteContent();
        alert('‚úÖ Contenu web sauvegard√© !\n\nVos modifications sont enregistr√©es et seront appliqu√©es lors de la prochaine publication.');
    }
}

function publishWebsite() {
    if (window.marketingIAManager) {
        window.marketingIAManager.saveWebsiteContent();
        alert('üöÄ SITE WEB PUBLI√â !\n\n‚úÖ Contenu mis √† jour\nüîç SEO optimis√©\nüì± Version mobile actualis√©e\n\nVotre site cynthiabernier.com est maintenant en ligne avec les derni√®res modifications !');
        
        if (window.marketingIAManager) {
            window.marketingIAManager.addAIMarketingMessage('üåê', 'Site publi√©', 'Contenu web mis √† jour et en ligne');
        }
    }
}

// Gestion Propri√©t√©s
function showPropertyTab(tabName) {
    document.querySelectorAll('.property-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.property-tab-content').forEach(content => content.classList.remove('active'));
    
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(`${tabName}-tab`).classList.add('active');
}

function generatePropertyDescription() {
    if (window.marketingIAManager) {
        window.marketingIAManager.generatePropertyDescription();
    }
}

function optimizePropertyForSEO() {
    if (window.marketingIAManager) {
        window.marketingIAManager.optimizePropertyForSEO();
    }
}

function analyzePropertyMarket() {
    if (window.marketingIAManager) {
        window.marketingIAManager.analyzePropertyMarket();
    }
}

function uploadPropertyPhotos() {
    alert('üì∏ UPLOAD PHOTOS\n\nFonctionnalit√© en d√©veloppement :\n‚Ä¢ Upload multiple de photos\n‚Ä¢ Redimensionnement automatique\n‚Ä¢ Optimisation pour web et r√©seaux sociaux\n‚Ä¢ Int√©gration avec galerie de propri√©t√©s');
}

function previewProperty() {
    const address = document.getElementById('propertyAddress').value;
    const price = document.getElementById('propertyPrice').value;
    
    if (!address || !price) {
        alert('‚ö†Ô∏è Veuillez saisir au moins l\'adresse et le prix pour la pr√©visualisation');
        return;
    }
    
    alert(`üëÅÔ∏è PR√âVISUALISATION FICHE\n\nüè† ${address}\nüí∞ ${parseInt(price).toLocaleString('fr-CA')} $\n\nLa fiche sera affich√©e avec le design final, les photos et toutes les informations format√©es professionnellement.\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement`);
}

function publishProperty() {
    if (window.marketingIAManager) {
        window.marketingIAManager.publishProperty();
    }
}

function createPropertyTemplate() {
    alert('üìÑ CR√âER TEMPLATE\n\nPermet de sauvegarder la configuration actuelle comme mod√®le r√©utilisable.\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function importTemplate() {
    alert('üì• IMPORTER TEMPLATE\n\nCharger un template existant pour pr√©-remplir le formulaire.\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

// Gestion R√©seaux Sociaux
function postToFacebook() {
    alert('üìò FACEBOOK POST\n\nCr√©er un nouveau post Facebook avec :\n‚Ä¢ Texte optimis√©\n‚Ä¢ Images haute qualit√©\n‚Ä¢ Hashtags cibl√©s\n‚Ä¢ Planification possible\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function scheduleFacebookPost() {
    alert('‚è∞ PROGRAMMER FACEBOOK\n\nPlanifier vos posts pour :\n‚Ä¢ Heures de pointe\n‚Ä¢ Jours optimaux\n‚Ä¢ √âv√©nements sp√©ciaux\n‚Ä¢ Campagnes coordonn√©es\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function viewFacebookAnalytics() {
    alert('üìä ANALYTICS FACEBOOK\n\nüìà Performances du mois :\n‚Ä¢ Port√©e : 5,678 personnes\n‚Ä¢ Engagement : 12.3%\n‚Ä¢ Clics vers site : 156\n‚Ä¢ Leads g√©n√©r√©s : 8\n\n‚ú® Tableau de bord complet en d√©veloppement');
}

function postToInstagram() {
    alert('üì∏ INSTAGRAM POST\n\nPublier photo/vid√©o avec :\n‚Ä¢ Filtres professionnels\n‚Ä¢ Stories interactives\n‚Ä¢ G√©olocalisation Lebel-sur-Qu√©villon\n‚Ä¢ Hashtags immobilier\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function createInstagramStory() {
    alert('üì± INSTAGRAM STORY\n\nCr√©er une story engageante :\n‚Ä¢ Templates immobilier\n‚Ä¢ Sondages et questions\n‚Ä¢ Visites virtuelles\n‚Ä¢ Coulisses m√©tier\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function viewInstagramInsights() {
    alert('üìä INSIGHTS INSTAGRAM\n\nüì± Performance Stories :\n‚Ä¢ Vues : 456 cette semaine\n‚Ä¢ Interactions : 23%\n‚Ä¢ Nouveaux abonn√©s : 12\n‚Ä¢ Port√©e : 892 comptes\n\n‚ú® Analyse d√©taill√©e en d√©veloppement');
}

function connectYoutube() {
    alert('üîó CONNECTER YOUTUBE\n\nConnexion √† votre cha√Æne YouTube pour :\n‚Ä¢ Upload vid√©os propri√©t√©s\n‚Ä¢ Vlogs immobiliers\n‚Ä¢ Conseils clients\n‚Ä¢ Visites virtuelles\n\n‚ú® Int√©gration en cours de d√©veloppement');
}

function uploadVideo() {
    alert('üé¨ UPLOAD VID√âO\n\nT√©l√©charger vid√©os :\n‚Ä¢ Visites de propri√©t√©s\n‚Ä¢ T√©moignages clients\n‚Ä¢ Conseils immobiliers\n‚Ä¢ Pr√©sentation services\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function viewYoutubeAnalytics() {
    alert('üìä ANALYTICS YOUTUBE\n\nTableau de bord complet en d√©veloppement');
}

function postToLinkedIn() {
    alert('üíº LINKEDIN POST\n\nArticles professionnels :\n‚Ä¢ Tendances march√©\n‚Ä¢ Conseils investissement\n‚Ä¢ Success stories\n‚Ä¢ Expertise r√©gionale\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function sharePropertyLinkedIn() {
    alert('üè† PARTAGE LINKEDIN\n\nPartager propri√©t√©s de mani√®re professionnelle avec r√©seau d\'affaires\n\n‚ú® Fonctionnalit√© en cours de d√©veloppement');
}

function viewLinkedInAnalytics() {
    alert('üìä ANALYTICS LINKEDIN\n\nAnalyse r√©seau professionnel en d√©veloppement');
}

// Cr√©ateur de contenu social
function showContentTab(tabName) {
    document.querySelectorAll('.content-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.content-tab-content').forEach(content => content.classList.remove('active'));
    
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(`${tabName}-tab`).classList.add('active');
}

function generateSocialContent() {
    if (window.marketingIAManager) {
        window.marketingIAManager.generateSocialContent();
    }
}

function addHashtags() {
    if (window.marketingIAManager) {
        window.marketingIAManager.addHashtags();
    }
}

function scheduleAllPlatforms() {
    const content = document.getElementById('postContent').value;
    
    if (!content.trim()) {
        alert('‚ö†Ô∏è Veuillez d\'abord g√©n√©rer ou saisir du contenu');
        return;
    }
    
    alert('üìÖ PLANIFICATION MULTI-PLATEFORMES\n\nüöÄ Votre contenu sera publi√© sur :\n‚úÖ Facebook - Demain 9h00\n‚úÖ Instagram - Demain 12h00\n‚úÖ LinkedIn - Demain 15h00\n\nüìä Port√©e estim√©e : 2,500+ personnes\n\n‚ú® Planificateur intelligent en d√©veloppement');
}

// Campagnes Marketing
function createMarketingCampaign() {
    if (window.marketingIAManager) {
        window.marketingIAManager.createMarketingCampaign();
    }
}

function viewCampaignTemplates() {
    alert('üìÑ TEMPLATES CAMPAGNES\n\nMod√®les disponibles :\n‚Ä¢ Nouvelle inscription\n‚Ä¢ Portes ouvertes\n‚Ä¢ T√©moignages clients\n‚Ä¢ March√© local\n‚Ä¢ Services expertise\n\n‚ú® Biblioth√®que templates en d√©veloppement');
}

function analyzeCampaignROI() {
    alert('üí∞ ANALYSE ROI CAMPAGNES\n\nüìä Performance globale :\n‚Ä¢ Investissement total : 1,200$\n‚Ä¢ Leads g√©n√©r√©s : 24\n‚Ä¢ Co√ªt par lead : 50$\n‚Ä¢ Taux conversion : 15%\n‚Ä¢ ROI estim√© : +280%\n\n‚ú® Tableau de bord ROI en d√©veloppement');
}

// üöÄ Initialisation
document.addEventListener('DOMContentLoaded', () => {
    window.marketingIAManager = new MarketingIAManager();
    console.log('‚úÖ Interface IA Marketing & Publication charg√©e et op√©rationnelle');
});

// Gestion des erreurs
window.addEventListener('error', (event) => {
    console.error('‚ùå Erreur IA Marketing:', event.error);
});